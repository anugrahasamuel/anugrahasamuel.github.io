---
title: "Assignment 2 – Google Trends"
format: html
editor: visual
execute:
  eval: false
---

## 1. Website data: load and inspect

```{r}
library(tidyverse)

# 1.1 Load the CSV you downloaded from Google Trends
web_trends <- read_csv(
  "data/web_trends_trump_kamala_election.csv",
  skip = 2
)

# 1.2 Inspect structure (optional)
glimpse(web_trends)
colnames(web_trends)

# Rename the date column to `date`, convert to Date,
# and make all keyword columns numeric (handle "<1")
web_trends <- web_trends |>
  rename(date = 1) |>
  mutate(
    date = as.Date(date),
    across(
      -date,
      ~ as.numeric(ifelse(as.character(.) == "<1", "0", as.character(.)))
    )
  )

# 1.3 Check date range and interval
range(web_trends$date)
unique(diff(web_trends$date))
```

## Plot Website Data (Interest Over Time)

```{r}
web_trends_long <- web_trends |>
  pivot_longer(
    cols = -date,
    names_to = "keyword",
    values_to = "hits"
  )

ggplot(web_trends_long, aes(x = date, y = hits, color = keyword)) +
  geom_line() +
  labs(
    title = "Google Trends (website download): Interest over time",
    x = "Date",
    y = "Search interest (0–100)"
  )
```

```{r}
library(gtrendsR)
```

## 2.1 Get the same queries via gtrendsR

```{r}
gt <- gtrends(
keyword = c("Trump", "Kamala Harris", "Election"),
geo     = "US",          # match the country you used on the website
time    = "today 12-m"   # or "2023-01-01 2024-01-01", etc.
)
```

# 2.2 Extract the interest_over_time table

```{r}

iot <- gt$interest_over_time |>
  mutate(
    hits = as.numeric(ifelse(hits == "<1", "0", as.character(hits)))
  )

iot <- gt$interest_over_time
glimpse(iot)
colnames(iot)
range(iot$date)
unique(diff(iot$date))
```

## Plot the gtrendsR data

```{r}
ggplot(iot, aes(x = date, y = hits, color = keyword)) +
geom_line() +
labs(
title = "Google Trends via gtrendsR: Interest over time",
x = "Date",
y = "Search interest (0–100)"
)
```

## Save to CSV and R formats

```{r}
# Website data

write_csv(web_trends, "data/web_trends_trump_kamala_election_clean.csv")
saveRDS(web_trends, "data/web_trends_trump_kamala_election.rds")

# gtrendsR data

write_csv(iot, "data/gtrends_trump_kamala_election.csv")
saveRDS(iot, "data/gtrends_trump_kamala_election.rds")
```
